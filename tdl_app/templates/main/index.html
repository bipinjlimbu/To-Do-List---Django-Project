<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>To-Do List</title>
    {% load static %}
    <link href="{% static 'src/styles.css' %}" rel="stylesheet" />
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- NAVBAR (TOP) -->
    {% include 'components/_navbar.html' %}

    {% if messages %}
        {% for message in messages %}
            <script>alert("{{ message }}")</script>
        {% endfor %}
    {% endif %}

    <!-- MAIN CONTENT -->
    <main class="flex-grow flex flex-col items-center px-4 py-8">

        <h1 class="text-4xl font-bold text-green-600 mb-6">
            My To-Do List
        </h1>

        <!-- Task Table -->
        <div class="overflow-x-auto w-full max-w-4xl">
            <table class="min-w-full bg-white rounded shadow overflow-hidden">
                <thead class="bg-green-500 text-white">
                    <tr>
                        <th class="px-4 py-2 text-left">ID</th>
                        <th class="px-4 py-2 text-left">Title</th>
                        <th class="px-4 py-2 text-left">Description</th>
                        <th class="px-4 py-2 text-center">Completed</th>
                        <th class="px-4 py-2 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if request.user.is_authenticated %}
                    {% for task in tasks %}
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-2">{{ task.id }}</td>
                            <td class="px-4 py-2 {% if task.completed %}line-through text-gray-400{% endif %}">
                                {{ task.title }}
                            </td>
                            <td class="px-4 py-2 {% if task.completed %}line-through text-gray-400{% endif %}">
                                {{ task.description }}
                            </td>
                            <td class="px-4 py-2 text-center">
                                {% if task.completed %}
                                    ✅
                                {% else %}
                                    ❌
                                {% endif %}
                            </td>
                            <td class="px-4 py-2 text-center flex justify-center space-x-2">
                                <form method="POST" action="{% url 'toggle_task' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                                        {% if task.completed %}Undo{% else %}Done{% endif %}
                                    </button>
                                </form>

                                <form method="POST" action="{% url 'delete_task' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-gray-500 py-4">
                                No tasks yet!
                            </td>
                        </tr>
                    {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-gray-500 py-4">
                                Please <a href="{% url 'login' %}" class="text-green-500 underline">login</a> to view your tasks.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

    </main>

    <!-- FOOTER (BOTTOM) -->
    {% include 'components/_footer.html' %}

</body>
</html>
